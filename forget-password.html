<!DOCTYPE html>
<html class="no-js" lang="">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <title>Forget Password</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="images/favicon.png" />
  <link rel="stylesheet" href="css/bootstrap-lg.min.css" />
  <link rel="stylesheet" href="css/style-lg.css" />
  <link rel="stylesheet" href="css/fontawesome-all-lg.min.css" />

  <style>
    .video-background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -1;
    }
    .error-message {
      color: #ff6b6b;
      font-size: 0.9em;
      margin-top: 5px;
      padding: 10px;
      background-color: rgba(255, 107, 107, 0.1);
      border-radius: 5px;
      border-left: 4px solid #ff6b6b;
    }
    .success-message {
      color: #51cf66;
      font-size: 0.9em;
      margin-top: 5px;
      padding: 10px;
      background-color: rgba(81, 207, 102, 0.1);
      border-radius: 5px;
      border-left: 4px solid #51cf66;
    }
    .info-message {
      color: #74c0fc;
      font-size: 0.9em;
      margin-top: 5px;
      padding: 10px;
      background-color: rgba(116, 192, 252, 0.1);
      border-radius: 5px;
      border-left: 4px solid #74c0fc;
    }
    .back-link {
      color: #fff;
      text-decoration: none;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      margin-bottom: 20px;
      transition: color 0.3s ease;
    }
    .back-link:hover {
      color: #74c0fc;
      text-decoration: none;
    }
    .form-info {
      background-color: rgba(116, 192, 252, 0.1);
      border: 1px solid rgba(116, 192, 252, 0.3);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      color: #74c0fc;
      font-size: 14px;
    }
    .step-indicator {
      display: flex;
      justify-content: center;
      margin-bottom: 25px;
    }
    .step {
      display: flex;
      align-items: center;
      color: #666;
      font-size: 14px;
    }
    .step.active {
      color: #74c0fc;
    }
    .step.completed {
      color: #51cf66;
    }
    .step-number {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background-color: #666;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 8px;
      font-weight: bold;
    }
    .step.active .step-number {
      background-color: #74c0fc;
    }
    .step.completed .step-number {
      background-color: #51cf66;
    }
    .step-separator {
      width: 40px;
      height: 2px;
      background-color: #666;
      margin: 0 15px;
    }
    .step.completed + .step-separator {
      background-color: #51cf66;
    }
    .form-step {
      display: none;
    }
    .form-step.active {
      display: block;
    }
    .otp-inputs {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
    }
    .otp-input {
      width: 50px;
      height: 50px;
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
    }
    .otp-input:focus {
      border-color: #74c0fc;
      outline: none;
      box-shadow: 0 0 10px rgba(116, 192, 252, 0.3);
    }
    .resend-link {
      color: #74c0fc;
      text-decoration: none;
      font-size: 14px;
      cursor: pointer;
    }
    .resend-link:hover {
      text-decoration: underline;
    }
    .resend-timer {
      color: #ffd43b;
      font-size: 14px;
    }
    .password-container {
      position: relative;
    }
    .password-toggle {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: #999;
      background: none;
      border: none;
      font-size: 16px;
    }
    .password-toggle:hover {
      color: #74c0fc;
    }
    .password-requirements {
      background-color: rgba(255, 212, 59, 0.1);
      border: 1px solid rgba(255, 212, 59, 0.3);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      color: #ffd43b;
      font-size: 13px;
    }
    .password-requirements ul {
      margin: 0;
      padding-left: 20px;
    }
    .password-requirements li {
      margin-bottom: 5px;
    }
  </style>
</head>

<body>
  <section class="fxt-template-animation fxt-template-layout6">
    <video autoplay muted loop playsinline class="video-background">
      <source src="images/video/artistic-video.mp4" type="video/mp4" />
    </video>

    <div class="fxt-content">
      <div class="fxt-header">
        <a href="index.html" class="fxt-logo">
          <img src="images/logo.png" style="width: 250px" alt="Logo" />
        </a>
      </div>
      <div class="fxt-form">
        <a href="login.html" class="back-link">
          <i class="fas fa-arrow-left me-2"></i>Back to Login
        </a>
        <h2 class="text-light">Reset Your Password</h2>
        
        <!-- Step Indicator -->
        <div class="step-indicator">
          <div class="step active" id="step1-indicator">
            <div class="step-number">1</div>
            <span>Email</span>
          </div>
          <div class="step-separator"></div>
          <div class="step" id="step2-indicator">
            <div class="step-number">2</div>
            <span>Verify OTP</span>
          </div>
          <div class="step-separator"></div>
          <div class="step" id="step3-indicator">
            <div class="step-number">3</div>
            <span>New Password</span>
          </div>
        </div>

        <!-- Step 1: Email Input -->
        <div class="form-step active" id="step1">
          <div class="form-info">
            <i class="fas fa-envelope me-2"></i>
            Enter your registered email address and we'll send you a verification code.
          </div>

          <form id="emailForm">
            <div class="form-group">
              <div class="fxt-transformY-50 fxt-transition-delay-3">
                <input
                  type="email"
                  class="form-control"
                  name="email"
                  id="email"
                  placeholder="Enter your registered email address"
                  required="required"
                />
              </div>
              
              <br />
              <div id="step1Message"></div>
              <div class="fxt-transformY-50 fxt-transition-delay-5">
                <button type="submit" class="fxt-btn-fill" id="emailSubmitBtn">
                  <i class="fas fa-paper-plane me-2"></i>Send Verification Code
                </button>
              </div>
            </div>
          </form>
        </div>

        <!-- Step 2: OTP Verification -->
        <div class="form-step" id="step2">
          <div class="form-info">
            <i class="fas fa-shield-alt me-2"></i>
            We've sent a 6-digit verification code to <span id="sentToEmail" class="fw-bold"></span>
          </div>

          <form id="otpForm">
            <div class="form-group">
              <div class="fxt-transformY-50 fxt-transition-delay-3">
                <div class="otp-inputs">
                  <input type="text" class="otp-input" id="otp1" maxlength="1" oninput="moveToNext(this, 'otp2')" onkeydown="moveToPrev(this, null, event)">
                  <input type="text" class="otp-input" id="otp2" maxlength="1" oninput="moveToNext(this, 'otp3')" onkeydown="moveToPrev(this, 'otp1', event)">
                  <input type="text" class="otp-input" id="otp3" maxlength="1" oninput="moveToNext(this, 'otp4')" onkeydown="moveToPrev(this, 'otp2', event)">
                  <input type="text" class="otp-input" id="otp4" maxlength="1" oninput="moveToNext(this, 'otp5')" onkeydown="moveToPrev(this, 'otp3', event)">
                  <input type="text" class="otp-input" id="otp5" maxlength="1" oninput="moveToNext(this, 'otp6')" onkeydown="moveToPrev(this, 'otp4', event)">
                  <input type="text" class="otp-input" id="otp6" maxlength="1" oninput="moveToNext(this, null)" onkeydown="moveToPrev(this, 'otp5', event)">
                </div>
              </div>
              
              <div class="text-center mb-3">
                <span class="resend-timer" id="resendTimer" style="display: none;">
                  Resend code in <span id="countdown">60</span> seconds
                </span>
                <a href="#" class="resend-link" id="resendLink" onclick="resendOTP()" style="display: none;">
                  <i class="fas fa-redo me-1"></i>Didn't receive code? Resend
                </a>
              </div>
              
              <br />
              <div id="step2Message"></div>
              <div class="fxt-transformY-50 fxt-transition-delay-5">
                <button type="submit" class="fxt-btn-fill" id="otpSubmitBtn">
                  <i class="fas fa-check me-2"></i>Verify Code
                </button>
              </div>
            </div>
          </form>
        </div>

        <!-- Step 3: Password Reset -->
        <div class="form-step" id="step3">
          <div class="form-info">
            <i class="fas fa-lock me-2"></i>
            Create a new secure password for your account.
          </div>

          <div class="password-requirements">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <strong>Password Requirements:</strong>
            <ul>
              <li>At least 8 characters long</li>
              <li>Contains at least one number</li>
              <li>Contains at least one uppercase letter</li>
              <li>Contains at least one lowercase letter</li>
            </ul>
          </div>

          <form id="passwordForm">
            <div class="form-group">
              <div class="fxt-transformY-50 fxt-transition-delay-3">
                <div class="password-container">
                  <input
                    type="password"
                    class="form-control"
                    name="newPassword"
                    id="newPassword"
                    placeholder="Enter new password"
                    required="required"
                    style="padding-right: 45px;"
                  />
                  <button type="button" class="password-toggle" onclick="togglePassword('newPassword', this)">
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
              </div>
              
              <br />
              
              <div class="fxt-transformY-50 fxt-transition-delay-4">
                <div class="password-container">
                  <input
                    type="password"
                    class="form-control"
                    name="confirmPassword"
                    id="confirmPassword"
                    placeholder="Confirm new password"
                    required="required"
                    style="padding-right: 45px;"
                  />
                  <button type="button" class="password-toggle" onclick="togglePassword('confirmPassword', this)">
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
              </div>
              
              <br />
              <div id="step3Message"></div>
              <div class="fxt-transformY-50 fxt-transition-delay-5">
                <button type="submit" class="fxt-btn-fill" id="passwordSubmitBtn">
                  <i class="fas fa-check-circle me-2"></i>Reset Password
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
      
      <div class="fxt-footer">
        <div class="fxt-transformY-50 fxt-transition-delay-10">
          <p>
            Remember your password?
            <a href="login.html" class="switcher-text2 inline-text">Login</a>
          </p>
          <p>
            Don't have an account?
            <a href="register.html" class="switcher-text2 inline-text">Register</a>
          </p>
        </div>
      </div>
    </div>
  </section>
  <!-- jquery-->
  <script src="js/jquery-lg.min.js"></script>
  <script src="js/bootstrap-lg.min.js"></script>
  <script src="js/imagesloaded.pkgd.min.js"></script>
  <script src="js/main-lg.js"></script>
  <script>
    let userEmail = '';
    let otpVerified = false;
    
    // Step 1: Email Form
    document.getElementById("emailForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      
      const submitBtn = document.getElementById("emailSubmitBtn");
      const originalText = submitBtn.innerHTML;
      
      // Disable button and show loading
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Sending...';
      
      // Hide previous messages
      hideMessages();
      
      // Get form data
      const email = document.getElementById("email").value.trim();
      
      // Validate email
      if (!email) {
        showMessage("Email address is required.", "error", "step1Message");
        resetButton(submitBtn, originalText);
        return;
      }
      
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        showMessage("Please enter a valid email address.", "error", "step1Message");
        resetButton(submitBtn, originalText);
        return;
      }
      
      try {
        const response = await fetch("https://new-moto.onrender.com/api/v1/send-otp", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email }),
        });
        
        const result = await response.json();
        
        if (response.ok) {
          userEmail = email;
          showMessage("Verification code sent successfully!", "success", "step1Message");
          document.getElementById("sentToEmail").textContent = email;
          
          setTimeout(() => {
            goToStep(2);
            startResendTimer();
          }, 1500);
        } else {
          showMessage(result.message || "Failed to send verification code. Please try again.", "error", "step1Message");
        }
      } catch (error) {
        console.error("Send OTP error:", error);
        showMessage("Network error. Please check your connection and try again.", "error", "step1Message");
      }
      
      resetButton(submitBtn, originalText);
    });
    
    // Step 2: OTP Form
    document.getElementById("otpForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      
      const submitBtn = document.getElementById("otpSubmitBtn");
      const originalText = submitBtn.innerHTML;
      
      // Disable button and show loading
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Verifying...';
      
      // Hide previous messages
      hideMessages();
      
      // Get OTP
      const otp = getOTPValue();
      
      if (otp.length !== 6) {
        showMessage("Please enter the complete 6-digit verification code.", "error", "step2Message");
        resetButton(submitBtn, originalText);
        return;
      }
      
      try {
        const response = await fetch("https://new-moto.onrender.com/api/v1/verify-otp", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email: userEmail, otp }),
        });
        
        const result = await response.json();
        
        if (response.ok) {
          otpVerified = true;
          showMessage("Code verified successfully!", "success", "step2Message");
          
          setTimeout(() => {
            goToStep(3);
          }, 1500);
        } else {
          showMessage(result.message || "Invalid verification code. Please try again.", "error", "step2Message");
          clearOTP();
        }
      } catch (error) {
        console.error("Verify OTP error:", error);
        showMessage("Network error. Please check your connection and try again.", "error", "step2Message");
      }
      
      resetButton(submitBtn, originalText);
    });
    
    // Step 3: Password Form
    document.getElementById("passwordForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      
      if (!otpVerified) {
        showMessage("Please complete OTP verification first.", "error", "step3Message");
        return;
      }
      
      const submitBtn = document.getElementById("passwordSubmitBtn");
      const originalText = submitBtn.innerHTML;
      
      // Disable button and show loading
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Resetting...';
      
      // Hide previous messages
      hideMessages();
      
      // Get form data
      const newPassword = document.getElementById("newPassword").value;
      const confirmPassword = document.getElementById("confirmPassword").value;
      
      // Validate passwords
      if (!newPassword || !confirmPassword) {
        showMessage("Both password fields are required.", "error", "step3Message");
        resetButton(submitBtn, originalText);
        return;
      }
      
      if (newPassword !== confirmPassword) {
        showMessage("Passwords do not match. Please try again.", "error", "step3Message");
        resetButton(submitBtn, originalText);
        return;
      }
      
      if (!validatePassword(newPassword)) {
        showMessage("Password does not meet the requirements. Please check the requirements above.", "error", "step3Message");
        resetButton(submitBtn, originalText);
        return;
      }
      
      try {
        const response = await fetch("https://new-moto.onrender.com/api/v1/reset-password-with-otp", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email: userEmail, newPassword }),
        });
        
        const result = await response.json();
        
        if (response.ok) {
          showMessage("Password reset successful! Redirecting to login...", "success", "step3Message");
          
          setTimeout(() => {
            window.location.href = "login.html";
          }, 3000);
        } else {
          showMessage(result.message || "Failed to reset password. Please try again.", "error", "step3Message");
        }
      } catch (error) {
        console.error("Reset password error:", error);
        showMessage("Network error. Please check your connection and try again.", "error", "step3Message");
      }
      
      resetButton(submitBtn, originalText);
    });
    
    // Helper Functions
    function goToStep(step) {
      // Hide all steps
      document.querySelectorAll('.form-step').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.step').forEach(s => s.classList.remove('active', 'completed'));
      
      // Show current step
      document.getElementById(`step${step}`).classList.add('active');
      document.getElementById(`step${step}-indicator`).classList.add('active');
      
      // Mark previous steps as completed
      for (let i = 1; i < step; i++) {
        document.getElementById(`step${i}-indicator`).classList.add('completed');
      }
      
      hideMessages();
    }
    
    function moveToNext(current, nextId) {
      if (current.value.length === 1 && nextId) {
        document.getElementById(nextId).focus();
      }
    }
    
    function moveToPrev(current, prevId, event) {
      if (event.key === 'Backspace' && current.value.length === 0 && prevId) {
        document.getElementById(prevId).focus();
      }
    }
    
    function getOTPValue() {
      let otp = '';
      for (let i = 1; i <= 6; i++) {
        otp += document.getElementById(`otp${i}`).value;
      }
      return otp;
    }
    
    function clearOTP() {
      for (let i = 1; i <= 6; i++) {
        document.getElementById(`otp${i}`).value = '';
      }
      document.getElementById('otp1').focus();
    }
    
    function startResendTimer() {
      let countdown = 60;
      const timer = document.getElementById('resendTimer');
      const link = document.getElementById('resendLink');
      const countdownEl = document.getElementById('countdown');
      
      timer.style.display = 'block';
      link.style.display = 'none';
      
      const interval = setInterval(() => {
        countdown--;
        countdownEl.textContent = countdown;
        
        if (countdown <= 0) {
          clearInterval(interval);
          timer.style.display = 'none';
          link.style.display = 'block';
        }
      }, 1000);
    }
    
    async function resendOTP() {
      try {
        const response = await fetch("https://new-moto.onrender.com/api/v1/send-otp", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email: userEmail }),
        });
        
        const result = await response.json();
        
        if (response.ok) {
          showMessage("New verification code sent!", "success", "step2Message");
          clearOTP();
          startResendTimer();
        } else {
          showMessage(result.message || "Failed to resend code.", "error", "step2Message");
        }
      } catch (error) {
        console.error("Resend OTP error:", error);
        showMessage("Network error. Please try again.", "error", "step2Message");
      }
    }
    
    function validatePassword(password) {
      const minLength = password.length >= 8;
      const hasUppercase = /[A-Z]/.test(password);
      const hasLowercase = /[a-z]/.test(password);
      const hasNumber = /\d/.test(password);
      
      return minLength && hasUppercase && hasLowercase && hasNumber;
    }
    
    function togglePassword(inputId, button) {
      const input = document.getElementById(inputId);
      const icon = button.querySelector('i');
      
      if (input.type === "password") {
        input.type = "text";
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
      } else {
        input.type = "password";
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
      }
    }
    
    function showMessage(message, type = "error", containerId) {
      const messageEl = document.getElementById(containerId);
      messageEl.textContent = message;
      messageEl.className = `${type}-message`;
      
      if (type === "success") {
        setTimeout(() => {
          messageEl.textContent = "";
          messageEl.className = "";
        }, 8000);
      }
    }
    
    function hideMessages() {
      ['step1Message', 'step2Message', 'step3Message'].forEach(id => {
        const el = document.getElementById(id);
        el.textContent = "";
        el.className = "";
      });
    }
    
    function resetButton(button, originalText) {
      button.disabled = false;
      button.innerHTML = originalText;
    }
    
    // Focus first OTP input when step 2 is shown
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('email').focus();
    });
  </script>
</body>
</html> 